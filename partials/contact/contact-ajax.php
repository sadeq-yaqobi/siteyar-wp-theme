<?php
 add_action('wp_ajax_sy_contact', 'sy_contact'); add_action('wp_ajax_nopriv_sy_contact', 'sy_contact'); function sy_contact() { if (!isset($_POST['_nonce']) && !wp_verify_nonce($_POST['_nonce'])) { wp_send_json([ 'error' => true, 'message' => 'دسترسی غیر مجاز است.', ], 403); } foreach ($_POST as $field) { if (empty($field)) { wp_send_json([ 'error' => true, 'message' => 'تکمیل تمامی فیلد ها الزامی است.' ], 422); } } $recaptcha = $_POST['recaptcha']; $secret_key = 'your secret key'; $url = 'https://www.google.com/recaptcha/api/siteverify?secret=' . $secret_key . '&response=' . $recaptcha; $response = file_get_contents($url); $response = json_decode($response); if (!$response->success) { wp_send_json([ 'error' => true, 'title' => 'دسترسی غیر مجاز است!', 'message' => 'من ربات نیستم را انتخاب کنید.' ], 403); } $full_name = sanitize_text_field($_POST['fullName']); $email = sanitize_text_field($_POST['email']); $title = sanitize_text_field($_POST['title']); $message = sanitize_textarea_field($_POST['message']); $header = ['Content-Type: text/html; charset=UTF-8']; $send_mail = wp_mail('mohamadi.amir9219@gmail.com', 'ایمیل آزمایشی', MailLayout::contact_layout($full_name, $email, $title, $message), $header); if ($send_mail) { wp_send_json([ 'success' => true, 'message' => 'درخواست شما با موفقیت ارسال شد.' ], 200); } else { wp_send_json([ 'error' => true, 'message' => 'خطا در ارسال درخواست. لطفا دوباره تلاش کنید.' ], 500); } }