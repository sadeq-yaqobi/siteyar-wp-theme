<?php
 add_action('wp_ajax_popular', 'popular'); add_action('wp_ajax_nopriv_popular', 'popular'); function popular() { if (!wp_verify_nonce($_POST['_nonce'])) { wp_send_json([ 'error' => true, 'message' => 'access denied' ], 403); } $args = [ 'post_type' => ['tech'], 'showposts' => 3, 'meta_key' => '_sy_post_view_nums', 'orderby' => 'meta_value_num', 'order' => 'DESC' ]; $the_query = new WP_Query($args); if ($the_query->have_posts()): $html_output = ''; while ($the_query->have_posts()): $the_query->the_post(); $html_output .= sy_tech_html_output(); endwhile; wp_send_json([ 'success'=>true, 'content' => $html_output, 'message' => 'فیلتر محتوا بر اساس محبوب‌ترین پست‌ها با موفقیت اعمال گردید' ],200); else: wp_send_json([ 'error' => true, 'message' => 'محبوب‌ترین یافت نشد', ],403); endif; wp_reset_postdata(); }